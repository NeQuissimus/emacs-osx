From 42d9068b3b5d620ccd6548dbb089368875e03f1f Mon Sep 17 00:00:00 2001
From: Konstantin Shabanov <mail@etehtsea.me>
Date: Mon, 9 Aug 2021 15:59:45 +0700
Subject: [PATCH] Disable titlebar on macOS

---
 src/nsterm.m | 16 ++++------------
 1 file changed, 4 insertions(+), 12 deletions(-)

diff --git a/src/nsterm.m b/src/nsterm.m
index ba5d81fb6c..28022822e6 100644
--- a/src/nsterm.m
+++ b/src/nsterm.m
@@ -433,11 +433,9 @@ - (NSColor *)colorUsingDefaultColorSpace

 /* These flags will be OR'd or XOR'd with the NSWindow's styleMask
    property depending on what we're doing.  */
-#define FRAME_DECORATED_FLAGS (NSWindowStyleMaskTitled              \
-                               | NSWindowStyleMaskResizable         \
-                               | NSWindowStyleMaskMiniaturizable    \
-                               | NSWindowStyleMaskClosable)
-#define FRAME_UNDECORATED_FLAGS NSWindowStyleMaskBorderless
+#define FRAME_UNDECORATED_FLAGS (NSWindowStyleMaskResizable         \
+                                | NSWindowStyleMaskMiniaturizable    \
+                                | NSWindowStyleMaskClosable)

 /* TODO: Get rid of need for these forward declarations.  */
 static void ns_condemn_scroll_bars (struct frame *f);
@@ -8217,10 +8215,8 @@ - (instancetype) initWithEmacsFrame:(struct frame *)f

   if (fullscreen)
     styleMask = NSWindowStyleMaskBorderless;
-  else if (FRAME_UNDECORATED (f))
-    styleMask = FRAME_UNDECORATED_FLAGS;
   else
-    styleMask = FRAME_DECORATED_FLAGS;
+    styleMask = FRAME_UNDECORATED_FLAGS;


   self = [super initWithContentRect:
@@ -8293,10 +8289,6 @@ - (instancetype) initWithEmacsFrame:(struct frame *)f
       if ([col alphaComponent] != (EmacsCGFloat) 1.0)
         [self setOpaque:NO];

-      /* toolbar support */
-      if (! FRAME_UNDECORATED (f))
-        [self createToolbar:f];
-
       /* macOS Sierra automatically enables tabbed windows.  We can't
          allow this to be enabled until it's available on a Free system.
          Currently it only happens by accident and is buggy anyway.  */
--
2.32.0
